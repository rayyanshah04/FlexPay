{% extends 'admin/base.html' %}

{% block title %}{{ user.name }} - User Details{% endblock %}

{% block content %}

{# Dummy Data for UI Preview #}
{% set user = {
'id': 1,
'name': 'Ahmed Khan',
'email': 'ahmed.khan@example.com',
'phone_number': '+92 300 1234567',
'balance': 15420.50,
'initials': 'AK',
'joined_ago': '3 months ago',
'created_at': '2024-09-08 14:30:00',
'last_active': '2 hours ago',
'device_token': 'ExponentPushToken[xxxxxxxxxxxxxxxxxxxxxx]',
'cards': [
{
'card_number': '4532123456789012',
'card_type': 'Visa',
'expiry_date': '12/26'
}
],
'transactions': [
{
'type': 'sent',
'amount': 500.00,
'timestamp': '2024-12-08 10:30 AM'
},
{
'type': 'received',
'amount': 1200.00,
'timestamp': '2024-12-07 03:15 PM'
},
{
'type': 'redeemed',
'amount': 250.00,
'timestamp': '2024-12-06 11:45 AM'
},
{
'type': 'sent',
'amount': 750.00,
'timestamp': '2024-12-05 09:20 AM'
},
{
'type': 'received',
'amount': 3000.00,
'timestamp': '2024-12-04 02:30 PM'
}
]
} %}
<style>
    .detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
    }

    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        color: var(--text-secondary);
        text-decoration: none;
        transition: all 0.2s;
        font-size: 14px;
        font-weight: 500;
    }

    .back-btn:hover {
        background-color: var(--hover-bg);
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    .user-header-card {
        background: linear-gradient(135deg, rgba(151, 71, 255, 0.15), rgba(112, 0, 255, 0.08));
        border: 1px solid rgba(151, 71, 255, 0.3);
        border-radius: 24px;
        padding: 40px;
        margin-bottom: 32px;
        display: flex;
        align-items: center;
        gap: 32px;
    }

    .user-avatar-xl {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), #7000ff);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 48px;
        flex-shrink: 0;
        box-shadow: 0 8px 32px rgba(151, 71, 255, 0.5);
    }

    .user-header-info {
        flex: 1;
    }

    .user-header-name {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-color);
        margin-bottom: 8px;
    }

    .user-header-meta {
        display: flex;
        gap: 24px;
        flex-wrap: wrap;
        margin-top: 16px;
    }

    .header-meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text-secondary);
    }

    .header-meta-item i {
        color: var(--primary-color);
    }

    .quick-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-top: 24px;
    }

    .quick-stat {
        text-align: center;
        padding: 16px;
        background-color: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }

    .quick-stat-label {
        font-size: 12px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }

    .quick-stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-color);
    }

    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
    }

    .detail-card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 28px;
    }

    .detail-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .detail-card-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-color);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .detail-card-title i {
        color: var(--primary-color);
        font-size: 18px;
    }

    .edit-btn {
        padding: 8px 16px;
        background-color: rgba(151, 71, 255, 0.1);
        border: 1px solid var(--primary-color);
        border-radius: 8px;
        color: var(--primary-color);
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .edit-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        padding: 16px 0;
        border-bottom: 1px solid var(--border-color);
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-size: 14px;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .info-value {
        font-size: 14px;
        color: var(--text-color);
        font-weight: 600;
        text-align: right;
        max-width: 60%;
        word-break: break-word;
    }

    .editable-input {
        width: 100%;
        padding: 12px 16px;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        color: var(--text-color);
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s;
    }

    .editable-input:focus {
        outline: none;
        border-color: var(--primary-color);
        background-color: rgba(255, 255, 255, 0.08);
    }

    .save-btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, var(--primary-color), #7000ff);
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 20px;
    }

    .save-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(151, 71, 255, 0.4);
    }

    .card-item {
        background-color: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        transition: all 0.2s;
    }

    .card-item:hover {
        border-color: var(--primary-color);
        background-color: rgba(151, 71, 255, 0.05);
    }

    .card-number {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 8px;
        letter-spacing: 2px;
    }

    .card-meta {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: var(--text-secondary);
    }

    .transaction-item {
        background-color: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.2s;
    }

    .transaction-item:hover {
        border-color: var(--primary-color);
        background-color: rgba(151, 71, 255, 0.05);
    }

    .transaction-info {
        flex: 1;
    }

    .transaction-type {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 4px;
    }

    .transaction-date {
        font-size: 12px;
        color: var(--text-secondary);
    }

    .transaction-amount {
        font-size: 18px;
        font-weight: 700;
    }

    .amount-positive {
        color: #30D158;
    }

    .amount-negative {
        color: #FF453A;
    }

    .full-width {
        grid-column: 1 / -1;
    }

    .empty-message {
        text-align: center;
        padding: 40px;
        color: var(--text-secondary);
        font-size: 14px;
    }

    .empty-message i {
        font-size: 48px;
        margin-bottom: 12px;
        opacity: 0.3;
    }

    .danger-zone {
        background-color: rgba(255, 69, 58, 0.05);
        border: 1px solid rgba(255, 69, 58, 0.3);
        border-radius: 20px;
        padding: 28px;
        margin-top: 24px;
    }

    .danger-zone-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--danger-color);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .danger-zone-desc {
        font-size: 13px;
        color: var(--text-secondary);
        margin-bottom: 20px;
    }

    .delete-btn {
        padding: 12px 24px;
        background-color: rgba(255, 69, 58, 0.1);
        border: 1px solid var(--danger-color);
        border-radius: 10px;
        color: var(--danger-color);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .delete-btn:hover {
        background-color: var(--danger-color);
        color: white;
    }

    @media (max-width: 968px) {
        .content-grid {
            grid-template-columns: 1fr;
        }

        .user-header-card {
            flex-direction: column;
            text-align: center;
        }

        .quick-stats {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>

<div class="detail-header">
    <a href="/admin/users" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Back to Users
    </a>
</div>

<!-- User Header -->
<div class="user-header-card">
    <div class="user-avatar-xl">{{ user.initials }}</div>
    <div class="user-header-info">
        <h1 class="user-header-name">{{ user.name }}</h1>
        <div class="user-header-meta">
            <div class="header-meta-item">
                <i class="fas fa-envelope"></i>
                <span>{{ user.email }}</span>
            </div>
            <div class="header-meta-item">
                <i class="fas fa-phone"></i>
                <span>{{ user.phone_number }}</span>
            </div>
            <div class="header-meta-item">
                <i class="fas fa-calendar"></i>
                <span>Joined {{ user.joined_ago }}</span>
            </div>
        </div>

        <div class="quick-stats">
            <div class="quick-stat">
                <div class="quick-stat-label">Balance</div>
                <div class="quick-stat-value">Rs {{ user.balance }}</div>
            </div>
            <div class="quick-stat">
                <div class="quick-stat-label">Card</div>
                <div class="quick-stat-value">{% if user.cards|length == 1 %}Yes{% else %}No{% endif %}</div>
            </div>
            <div class="quick-stat">
                <div class="quick-stat-label">Transactions</div>
                <div class="quick-stat-value">{{ user.transactions|length }}</div>
            </div>
            <div class="quick-stat">
                <div class="quick-stat-label">User ID</div>
                <div class="quick-stat-value">#{{ user.id }}</div>
            </div>
        </div>
    </div>
</div>

<!-- Content Grid -->
<div class="content-grid">
    <!-- Personal Information -->
    <div class="detail-card">
        <div class="detail-card-header">
            <h2 class="detail-card-title">
                <i class="fas fa-user"></i>
                Personal Information
            </h2>
            <button class="edit-btn" onclick="toggleEdit('personal')">
                <i class="fas fa-edit"></i>
                Edit
            </button>
        </div>

        <form id="personalForm" method="POST" action="/admin/users/{{ user.id }}/update">
            <div class="info-row">
                <span class="info-label">Full Name</span>
                <span class="info-value" id="name-display">{{ user.name }}</span>
                <input type="text" name="name" value="{{ user.name }}" class="editable-input" id="name-input"
                    style="display: none;">
            </div>
            <div class="info-row">
                <span class="info-label">Email Address</span>
                <span class="info-value" id="email-display">{{ user.email }}</span>
                <input type="email" name="email" value="{{ user.email }}" class="editable-input" id="email-input"
                    style="display: none;">
            </div>
            <div class="info-row">
                <span class="info-label">Phone Number</span>
                <span class="info-value" id="phone-display">{{ user.phone_number }}</span>
                <input type="tel" name="phone_number" value="{{ user.phone_number }}" class="editable-input"
                    id="phone-input" style="display: none;">
            </div>
            <div class="info-row">
                <span class="info-label">Password</span>
                <span class="info-value" id="password-display">••••••••</span>
                <input type="text" name="password" placeholder="Enter new password" class="editable-input"
                    id="password-input" style="display: none;">
            </div>
            <button type="submit" class="save-btn" id="personal-save" style="display: none;">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </form>
    </div>

    <!-- Account Details -->
    <div class="detail-card">
        <div class="detail-card-header">
            <h2 class="detail-card-title">
                <i class="fas fa-wallet"></i>
                Account Details
            </h2>
            <button class="edit-btn" onclick="toggleEdit('account')">
                <i class="fas fa-edit"></i>
                Edit
            </button>
        </div>

        <form id="accountForm" method="POST" action="/admin/users/{{ user.id }}/update">
            <div class="info-row">
                <span class="info-label">Current Balance</span>
                <span class="info-value" id="balance-display">Rs {{ user.balance }}</span>
                <input type="number" step="0.01" name="balance" value="{{ user.balance }}" class="editable-input"
                    id="balance-input" style="display: none;">
            </div>
            <div class="info-row">
                <span class="info-label">Account Created</span>
                <span class="info-value">{{ user.created_at }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Last Active</span>
                <span class="info-value">{{ user.last_active or 'Never' }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Device Token</span>
                <span class="info-value">{{ user.device_token[:20] + '...' if user.device_token else 'Not Set' }}</span>
            </div>
            <button type="submit" class="save-btn" id="account-save" style="display: none;">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </form>
    </div>

    <!-- Cards -->
    <div class="detail-card">
        <div class="detail-card-header">
            <h2 class="detail-card-title">
                <i class="fas fa-credit-card"></i>
                Linked Card{% if user.cards|length > 0 %} (1){% endif %}
            </h2>
        </div>

        {% if user.cards %}
        {% for card in user.cards %}
        <div class="card-item">
            <div class="card-number">•••• •••• •••• {{ card.card_number[-4:] }}</div>
            <div class="card-meta">
                <span>{{ card.card_type }}</span>
                <span>Exp: {{ card.expiry_date }}</span>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="empty-message">
            <i class="fas fa-credit-card"></i>
            <p>No cards linked</p>
        </div>
        {% endif %}
    </div>

    <!-- Recent Transactions -->
    <div class="detail-card">
        <div class="detail-card-header">
            <h2 class="detail-card-title">
                <i class="fas fa-exchange-alt"></i>
                Recent Transactions
            </h2>
        </div>

        {% if user.transactions %}
        {% for transaction in user.transactions[:5] %}
        <div class="transaction-item">
            <div class="transaction-info">
                <div class="transaction-type">{{ transaction.type|title }}</div>
                <div class="transaction-date">{{ transaction.timestamp }}</div>
            </div>
            <div
                class="transaction-amount {% if transaction.type == 'received' or transaction.type == 'redeemed' %}amount-positive{% else %}amount-negative{% endif %}">
                {% if transaction.type == 'received' or transaction.type == 'redeemed' %}+{% else %}-{% endif %}Rs {{
                transaction.amount }}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="empty-message">
            <i class="fas fa-exchange-alt"></i>
            <p>No transactions yet</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Danger Zone -->
<div class="danger-zone">
    <h3 class="danger-zone-title">
        <i class="fas fa-exclamation-triangle"></i>
        Danger Zone
    </h3>
    <p class="danger-zone-desc">
        Deleting this user will permanently remove all their data, including transactions and cards. This action cannot
        be undone.
    </p>
    <button class="delete-btn" onclick="confirmDelete()">
        <i class="fas fa-trash"></i> Delete User
    </button>
</div>

<script>
    function toggleEdit(section) {
        if (section === 'personal') {
            // Toggle display/input fields
            document.getElementById('name-display').style.display =
                document.getElementById('name-display').style.display === 'none' ? 'block' : 'none';
            document.getElementById('name-input').style.display =
                document.getElementById('name-input').style.display === 'none' ? 'block' : 'none';

            document.getElementById('email-display').style.display =
                document.getElementById('email-display').style.display === 'none' ? 'block' : 'none';
            document.getElementById('email-input').style.display =
                document.getElementById('email-input').style.display === 'none' ? 'block' : 'none';

            document.getElementById('phone-display').style.display =
                document.getElementById('phone-display').style.display === 'none' ? 'block' : 'none';
            document.getElementById('phone-input').style.display =
                document.getElementById('phone-input').style.display === 'none' ? 'block' : 'none';

            document.getElementById('password-display').style.display =
                document.getElementById('password-display').style.display === 'none' ? 'block' : 'none';
            document.getElementById('password-input').style.display =
                document.getElementById('password-input').style.display === 'none' ? 'block' : 'none';

            document.getElementById('personal-save').style.display =
                document.getElementById('personal-save').style.display === 'none' ? 'block' : 'none';
        } else if (section === 'account') {
            document.getElementById('balance-display').style.display =
                document.getElementById('balance-display').style.display === 'none' ? 'block' : 'none';
            document.getElementById('balance-input').style.display =
                document.getElementById('balance-input').style.display === 'none' ? 'block' : 'none';

            document.getElementById('account-save').style.display =
                document.getElementById('account-save').style.display === 'none' ? 'block' : 'none';
        }
    }

    function confirmDelete() {
        if (confirm('Are you sure you want to delete this user? This action cannot be undone!')) {
            window.location.href = '/admin/users/{{ user.id }}/delete';
        }
    }
</script>

{% endblock %}